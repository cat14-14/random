<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>자리 뽑기</title>
  <link rel="icon" href="favicon.png" type="image/png">

  <style>
    * { box-sizing: border-box; transition: all 0.3s ease; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      background: linear-gradient(to bottom, #e0f2fe, #dbeafe);
      overflow-x: hidden;
    }
    .container {
      max-width: 600px;
      margin: 80px auto;
      padding: 30px;
      border-radius: 20px;
      background: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; color: #1d4ed8; }
    label { font-weight: bold; display: block; color: #374151; margin-top: 20px; }
    input, button {
      width: 100%; padding: 10px; margin-top: 5px;
      border-radius: 10px; font-size: 16px;
    }
    button {
      background: #6366f1; color: white; border: none; font-weight: bold; margin-top: 15px;
    }
    button:active { transform: scale(0.97); }
    .mode-selector {
      display: flex; justify-content: space-between; gap: 10px; margin-bottom: 15px;
    }
    .group {
      background: #f3f4f6; padding: 15px; margin-bottom: 15px;
      border-left: 5px solid #6366f1; border-radius: 10px;
    }
    .group strong {
      color: #4f46e5; display: block; margin-bottom: 5px;
    }
    .group span {
      display: inline-block; margin: 4px; padding: 6px 10px;
      background: #e0e7ff; border-radius: 8px;
    }
    .group span:hover {
      background: #c7d2fe; transform: scale(1.1);
    }
    .result { margin-top: 20px; }
    .hidden { display: none; }
    #wheelWrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    #wheelCanvas {
      margin-top: 40px;
      border-radius: 50%;
    }
    .pointer {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid red;
      position: absolute;
      top: 15px;
      z-index: 10;
    }
    #wheelResult {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #1d4ed8;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>자리 뽑기</h1>
    <div class="mode-selector">
      <button onclick="setMode('name')">이름으로 뽑기</button>
      <button onclick="setMode('number')">번호로 뽑기</button>
      <button onclick="setMode('lotto')">제비뽑기</button>
      <button onclick="setMode('wheel')">돌림판</button>
    </div>

    <div id="nameMode">
      <label>이름 목록 (쉼표로 구분)</label>
      <input type="text" id="names" placeholder="예: 철수, 영희, 민수">
      <label>모둠 수</label>
      <input type="number" id="groupCountName" placeholder="예: 3">
      <button onclick="drawByName()">이름 모둠 뽑기</button>
    </div>

    <div id="numberMode" class="hidden">
      <label>총 인원 수</label>
      <input type="number" id="count" placeholder="예: 10">
      <label>모둠 수</label>
      <input type="number" id="groupCount" placeholder="예: 3">
      <button onclick="drawByNumber()">번호 모둠 뽑기</button>
    </div>

    <div id="lottoMode" class="hidden">
      <label>제비뽑기 대상 수</label>
      <input type="number" id="lottoCount" placeholder="예: 10">
      <label>몇 명을 뽑을까요?</label>
      <input type="number" id="lottoDraw" placeholder="예: 2">
      <button onclick="drawLotto()">제비 뽑기</button>
    </div>

    <div id="wheelMode" class="hidden">
      <label>대상 이름 (쉼표로 구분) 또는 숫자 개수</label>
      <input type="text" id="wheelInput" placeholder="예: 철수, 영희 또는 10" oninput="parseWheelInput()">
      <button onclick="spinWheel()">🎡 돌리기</button>
      <div id="wheelWrapper">
        <div class="pointer"></div>
        <canvas id="wheelCanvas" width="300" height="300"></canvas>
      </div>
      <div id="wheelResult"></div>
    </div>

    <button onclick="clearResult()">결과 초기화</button>
    <div id="result" class="result"></div>
  </div>

<script>
let wheelItems = [];
let rotation = 0;
let isSpinning = false;
let spinVelocity = 0;
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');
const radius = 140;

function setMode(mode) {
  ['name', 'number', 'lotto', 'wheel'].forEach(id => {
    document.getElementById(id + 'Mode').classList.add('hidden');
  });
  document.getElementById(mode + 'Mode').classList.remove('hidden');
  clearResult();
  if (mode === 'wheel') {
    const input = document.getElementById('wheelInput');
    if (!input.value.trim()) input.value = '4';
    parseWheelInput();
  }
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function drawByName() {
  const names = document.getElementById('names').value.split(',').map(n => n.trim()).filter(n => n);
  const groupCount = parseInt(document.getElementById('groupCountName').value);
  const result = document.getElementById('result');
  result.innerHTML = '';
  if (!names.length || !groupCount || groupCount <= 0) return;
  shuffle(names);
  const groups = Array.from({ length: groupCount }, () => []);
  names.forEach((name, i) => groups[i % groupCount].push(name));
  groups.forEach((group, i) => {
    const div = document.createElement('div');
    div.className = 'group';
    div.innerHTML = `<strong>${i + 1}모둠</strong>` + group.map(n => `<span>${n}</span>`).join(' ');
    result.appendChild(div);
  });
}

function drawByNumber() {
  const count = parseInt(document.getElementById('count').value);
  const groupCount = parseInt(document.getElementById('groupCount').value);
  const result = document.getElementById('result');
  result.innerHTML = '';
  if (!count || !groupCount || groupCount <= 0 || count < groupCount) return;
  let list = Array.from({ length: count }, (_, i) => `${i + 1}`);
  shuffle(list);
  const base = Math.floor(count / groupCount);
  const rest = count % groupCount;
  const groups = Array.from({ length: groupCount }, () => []);
  let idx = 0;
  for (let i = 0; i < groupCount; i++) {
    for (let j = 0; j < base; j++) groups[i].push(list[idx++]);
  }
  for (let i = 0; i < rest; i++) {
    groups[groupCount - 1].push(list[idx++]);
  }
  groups.forEach((group, i) => {
    const div = document.createElement('div');
    div.className = 'group';
    div.innerHTML = `<strong>${i + 1}모둠</strong>` + group.map(n => `<span>${n}번</span>`).join(' ');
    result.appendChild(div);
  });
}

function drawLotto() {
  const total = parseInt(document.getElementById('lottoCount').value);
  const pickCount = parseInt(document.getElementById('lottoDraw').value);
  const result = document.getElementById('result');
  result.innerHTML = '';
  if (!total || !pickCount || total < pickCount) return;
  let list = Array.from({ length: total }, (_, i) => `${i + 1}`);
  shuffle(list);
  const picks = list.slice(0, pickCount);
  const box = document.createElement('div');
  box.className = 'group';
  picks.forEach(num => {
    const item = document.createElement('span');
    item.textContent = `${num}번`;
    box.appendChild(item);
  });
  result.appendChild(box);
}

function clearResult() {
  document.getElementById('result').innerHTML = '';
  document.getElementById('wheelResult').innerText = '';
  if (!document.getElementById('wheelMode').classList.contains('hidden')) {
    rotation = 0;
    drawWheel();
  }
}

function parseWheelInput() {
  const input = document.getElementById('wheelInput').value.trim();
  if (!input) return;
  if (/^\d+$/.test(input)) {
    wheelItems = Array.from({ length: parseInt(input) }, (_, i) => `${i + 1}`);
  } else {
    wheelItems = input.split(',').map(x => x.trim()).filter(x => x);
  }
  drawWheel();
}

function getSelectedIndexFromRotation(rotation, count) {
  const arc = 2 * Math.PI / count;
  const pointerAngle = ((-Math.PI / 2 - rotation) % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI);
  let index = Math.floor(pointerAngle / arc);
  return index;
}

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const count = wheelItems.length;
  if (count < 2) return;
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const arc = 2 * Math.PI / count;
  const selectedIndex = getSelectedIndexFromRotation(rotation, count);

  wheelItems.forEach((item, i) => {
    const angle = i * arc;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, angle + rotation, angle + arc + rotation);
    ctx.closePath();
    ctx.fillStyle = `hsl(${i * 360 / count}, 80%, 70%)`;
    ctx.fill();
    if (i === selectedIndex) {
      ctx.strokeStyle = 'red';
      ctx.lineWidth = 4;
      ctx.stroke();
    }
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(angle + arc / 2 + rotation);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#111';
    ctx.font = '14px sans-serif';
    ctx.fillText(item, radius - 10, 5);
    ctx.restore();
  });
}

function spinWheel() {
  if (wheelItems.length < 2 || isSpinning) return;
  spinVelocity = 0.4 + Math.random() * 0.5;
  isSpinning = true;
  requestAnimationFrame(animateSpin);
}

function animateSpin() {
  if (!isSpinning) return;
  rotation += spinVelocity;
  spinVelocity *= 0.985;
  drawWheel();
  if (spinVelocity < 0.002) {
    isSpinning = false;
    const selectedIndex = getSelectedIndexFromRotation(rotation, wheelItems.length);
    const winner = wheelItems[selectedIndex];
    document.getElementById('wheelResult').innerText = winner
      ? `🎉 당첨: ${winner}`
      : '🎉 당첨: (선택 불가)';
  } else {
    requestAnimationFrame(animateSpin);
  }
}
</script>
</body>
</html>
